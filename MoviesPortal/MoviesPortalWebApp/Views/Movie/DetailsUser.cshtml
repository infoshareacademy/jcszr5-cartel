@using System.Security.Claims
@using BusinessLogic.ApiHandler
@using BusinessLogic.ApiHandler.ApiModels
@using DataAccess.Models.EntityAssigments
@using DataAccess.Repositories
@model MoviesPortalWebApp.Models.MovieVM
@using Microsoft.AspNetCore.Identity;
@using MoviesPortalWebApp.AssigmentsVM

@inject UserManager<DataAccess.Models.ApplicationUser> UserManager;

@{
    ViewData["Title"] = "DetailsUser";
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    List<CreativePersonVM> actors = ViewBag.Actors;
    List<CreativePersonVM> directors = ViewBag.Directors;
    
    //var listFavourities = Model.UserFavoriteMovies.Where(u => u.UserId == @UserManager.GetUserId(User)).ToList();
    //var fMovieId = Model.UserFavoriteMovies.FirstOrDefault(u => u.UserId == @UserManager.GetUserId(User));
}


<img class="BackgroundPoster" src="@Model.BackgroundPoster" alt=""/>

 <div class="main-informations">
     <div class="genre">@string.Join(" | ", @Model.Genres.Select(g => g.Genre)).ToUpper()</div>

     <div class="Title">@Model.Title.ToUpper()</div>

<p class="inline"><strong>@Model.ProductionYear</strong><span class="vanila"> |</span> </p>
@{  }  

<strong>
      @if(directors.Count == 1)
            {
               <p class="inline" id="name">Director:</p>
            }
            else if(directors.Count > 1)
            {
                <p class="inline" id="name">Directors:</p>
            }
</strong>
<p class="inline"
<strong>
         @if(directors.Count == 1)
            {
                <span>
                 <a asp-controller="CreativePerson" asp-action="DetailsUser" asp-route-id="@directors.Single().Id" class="vanila">@directors.Single().Name @directors.Single().SurName</a> 
                
             </span>
            }
            else if(directors.Count > 1)
            {
                <p>
                    @foreach (var director in directors)
                    {<span>
                        <a asp-controller="CreativePerson" asp-action="DetailsUser" asp-route-id="@director.Id" class="vanila">@director.Name @director.SurName</a>
                       <span class="vanila"> |</span>
                    </span>
                    }

                </p>
            }
            </strong>
            </p>
          

<p class="inline"><strong>Cast:</strong></p>
<p class="inline">

<strong>
      @foreach (var person in actors)
                    {
                        <span>
                            <a asp-controller="CreativePerson" asp-action="DetailsUser" asp-route-id="@person.Id" class="vanila">@person.Name @person.SurName</a>
                       <span class="vanila"> |</span>
                        </span>
                    }
</strong>
      </p>
         <p class="description">
         <div class="vanila-ice">@Model.Description</div>
     </p>

     <partial name="_ShowAllComments" />
     

@*@if (User.Identity.IsAuthenticated && User.IsInRole("User"))
        {

            if(listFavourities.Count > 0)
            {
                <a class="fav" asp-controller="Account" asp-action="RemoveMovieToFavourities" asp-route-id="@fMovieId.Id"><i class="fa fa-heart"></i></a>
            } 
            else
            {
                <a class="fav" asp-controller="Account" asp-action="AddMovieToFavourities" asp-route-id="@Model.Id"><i class="fa fa-heart-o"></i></a>
            }
        }*@
</div>

